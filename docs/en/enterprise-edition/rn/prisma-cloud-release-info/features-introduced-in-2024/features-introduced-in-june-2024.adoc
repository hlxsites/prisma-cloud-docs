== Features Introduced in June 2024

Learn what's new on Prisma® Cloud in June 2024.

* <<new-features>>
* <<changes-in-existing-behavior>>
* <<api-ingestions>>
* <<new-policies>>
* <<iam-policies>>
//* <<policy-updates>>
* <<new-compliance-benchmarks-and-updates>>
* <<rest-api-updates>>
* <<deprecation-notices>>


[#new-features]
=== New Features

[cols="50%a,50%a"]
|===
|*Feature*
|*Description*

|*Vulnerabilities Tab*

tt:[*24.6.1*]

tt:[Secure the Infrastructure]
//RLP-132742

|Explore the new *Vulnerabilities* tab in the side panel while inspecting internet-exposed assets. You can now see Common Vulnerabilities and Exposures (CVE) discovered on the exposed asset. The severity levels of the CVEs are categorized based on the Common Vulnerability Scoring System (CVSS) scores, helping you to make informed decisions and take appropriate actions to secure the internet-exposed asset.

image::vulnerabilities-tab.gif[60]

|*Update Top Risks From Unmanaged Assets Widget*

tt:[*24.6.1*]

tt:[Secure the Infrastructure]
//RLP-132742

|The https://docs.prismacloud.io/en/enterprise-edition/content-collections/dashboards/dashboards-discovery-exposure-management[Top Risks From Unmanaged Assets] widget in the Discovery and Exposure Management Dashboard is enhanced to display the top risks based on various categories that affect your security posture due to public exposure of assets on the internet. The risks are categorized as Critical, Exploited, Patchable, Vulnerable, and Exposed. Links offer additional context and options to convert and inspect affected assets, helping you to quickly assess and address potential threats. 

image::top-risks-from-unmanaged-assets-widget.png[]


|*Improved IAM Risk Management*

tt:[*24.6.1*]

tt:[Secure the Infrastructure]
//RLP-141441

|Enhancements to Prisma Cloud's https://docs.prismacloud.io/en/enterprise-edition/content-collections/governance/create-an-iam-policy[IAM policies] enable you to proactively manage IAM-related risks and improve your cloud security posture. Gain granular visibility into violations at the entity level by creating IAM policies based on queries that include "granters" (roles/groups/service accounts) as the violating resource. Next, develop remediation to fix IAM policy violations at the granter level or use the “Suggest Least Privileged Access” feature to remediate over-privileged access by select granters.

|*Snooze Assets from Inventory Page*

tt:[*24.6.1*]

tt:[Secure the Infrastructure]
//RLP-140581

|You now have the option to *Snooze* known internet-exposed assets, such as test or vendor assets, in the *Inventory > Unmanaged Assets* page. Snoozing assets help you to view Active assets separately from Snoozed assets using the Status filter. You can Snooze one or multiple assets at a time. Use the search bar to find your assets. Filter your search results by *Domain* name or *IP Address*.

image::snooze-assets.png[]

|*Account Mapped Status Filter*

tt:[*24.6.1*]

tt:[Secure the Infrastructure]
//RLP-140581

|The *Inventory > Unmanaged Assets* page now includes a new *Account Mapped Status* filter. Use this filter to view a comprehensive list of your Mapped assets separately from Unmapped assets.

*Mapped* — Shows exposed assets that are linked to a parent account or organizational unit (OU) accounts on Prisma Cloud. You can secure these assets by onboarding them to Prisma Cloud.
*Unmapped* — Shows exposed assets that cannot be linked to a parent account or organizational unit (OU) accounts on Prisma Cloud. You can an Send Email to receive a summary of the assets for further investigation.

image::account-mapped-status.png[]


|*Terraform Enterprise (Run Tasks) support for Transporter*

tt:[*24.6.1*]

tt:[Secure the Source]
//BCE-34224

| https://docs.prismacloud.io/en/enterprise-edition/content-collections/application-security/get-started/connect-code-and-build-providers/ci-cd-runs/add-terraform-enterprise-run-tasks#undefined[Terraform Enterprise (Run Tasks)] now includes support for Transporter. The Transporter serves as a communication proxy or broker, facilitating a secure channel between Prisma Cloud and Terraform Enterprise (Run Tasks). This enables seamless integration and management of Terraform Enterprise within your infrastructure while maintaining stringent security measures.

|*Support for AWS CodeCommit Integration*

tt:[*24.6.1*]

tt:[Secure the Source]
//BCE-34167

|Integrate prisma Cloud with https://docs.prismacloud.io/en/enterprise-edition/content-collections/application-security/get-started/connect-code-and-build-providers/code-repositories/add-aws-codecommit[AWS Code Commit] version control system (VCS) to gain visibility into, and monitor the systems, technologies, configurations, and pipelines that make up the AWS CodeCommit platform. This integration enables security scans to identify Infrastructure-as-Code (IaC) misconfigurations, Software Composition Analysis (SCA) vulnerabilities, license non-compliance, exposed secrets and CI/CD pipeline risks in your AWS CodeCommit platform. Enhance the security posture for your organization by contextualizing, prioritizing and mitigating issues as soon as they are detected.

|*Enhanced Security for JavaScript Projects: SCA Now Supports Lockfile v3*

tt:[*24.6.1*]

tt:[Secure the Source]
//BCE-33820

|SCA support is now available for https://docs.prismacloud.io/en/enterprise-edition/content-collections/application-security/risk-management/monitor-and-manage-code-build/software-composition-analysis/sca-troubleshoot[JavaScript Lockfile v3]. This added support offers:

* Vulnerability detection and license compliance: Prisma Cloud can now parse, analyze, and report vulnerabilities, and ensure license compliance for projects using package-lock.json v3
* Full dependency tree analysis: Provides a comprehensive view of all dependencies and sub-dependencies to identify potential risks
* Cross-platform support: Supported across Prisma Cloud platforms such as PR comments, Fix PRs, Enforcement, IDE, and CLI


|===

[#changes-in-existing-behavior]
=== Changes in Existing Behavior

[cols="50%a,50%a"]
|===
|*Feature*
|*Description*

|*API Rate Limits*
//RLP-129569, RLP-139236

|Prisma Cloud uses API https://pan.dev/prisma-cloud/api/cspm/rate-limits/[rate limits] at the endpoint level to protect the performance and availability of its services. Rate limits will be applied to additional APIs starting from the 24.6.1 release. 

For more information, see the <<api-rate-limits>> table below.

|===

//RLP-129569, RLP-139236

Rate limits will apply to the following endpoints in release *24.6.1*.

[cols="60%a,20%a,20%a"]
|===
|*Endpoint*
|*Rate Limit (tps)*
|*Burst Rate (tps)*

3+|*Resource Lists*

|Get Resource Lists -  https://pan.dev/prisma-cloud/api/cspm/get-all-resource-list-for-customer/[GET /v1/resource_list] 
|80 
|80

|Get Resource List by ID - https://pan.dev/prisma-cloud/api/cspm/get-resource-list-by-id/[GET /v1/resource_list/#id]
|4
|4

|Get Resource List Types - https://pan.dev/prisma-cloud/api/cspm/get-resource-list-types/[GET /v1/resource_list/types]
|4
|4

|Get Resource List Names -  GET /v1/resource_list/names
|80 
|80


3+|*Account Groups*

|List Account Groups - https://pan.dev/prisma-cloud/api/cspm/get-account-groups/[GET /cloud/group]
|32
|32

|Account Group Info -  https://pan.dev/prisma-cloud/api/cspm/get-account-group/[GET /cloud/group/#id]
|80
|80

|List Account Group Names - https://pan.dev/prisma-cloud/api/cspm/get-account-group-name/[GET /cloud/group/name]
|32
|32

|List Account Group Names by Cloud Type - https://pan.dev/prisma-cloud/api/cspm/get-account-group-name-by-cloud-type/[GET cloud/group/name/#cloud_type]
|4
|4

3+|*Collections*

| Get All Collections - https://pan.dev/prisma-cloud/api/cspm/get-all-collections/[GET /entitlement/api/v1/collection]
|4
|4

| Get Collection by ID - https://pan.dev/prisma-cloud/api/cspm/get-collection-by-id/[GET /entitlement/api/v1/collection/#id]
|8
|8

|===

[#api-ingestions]
=== API Ingestions

[cols="50%a,50%a"]
|===
|*Service*
|*API Details*


|*Amazon CloudFront*

tt:[*24.6.1*]
//RLP-139944

|*aws-cloudfront-response-headers-policy*

Additional permissions required:

* `cloudfront:ListResponseHeadersPolicies`
* `cloudfront:GetResponseHeadersPolicy`

The Security Audit role includes the permissions. 

|*AWS Database Migration Service*

tt:[*24.6.1*]
//RLP-139939

|*aws-dms-replication-task*

Additional permissions required:

* `dms:DescribeReplicationTasks`
* `dms:ListTagsForResource`

The Security Audit role includes the permissions. 

|*AWS Network Firewall*

tt:[*24.6.1*]
//RLP-139913

|*aws-network-firewall-rule-group*

Additional permissions required:

* `network-firewall:ListRuleGroups`
* `network-firewall:DescribeRuleGroup`

The Security Audit role includes the permissions. 

|*AWS Glue*

tt:[*24.6.1*]
//RLP-139895

|*aws-glue-resource-policy*

Additional permission required:

* `glue:GetResourcePolicies`

You must manually add the above permission to the CFT template to enable it.

//The Security Audit role includes the permissions. 

|*AWS Macie*

tt:[*24.6.1*]
//RLP-139941

|*aws-macie2-classification-job*

Additional permission required:

* `macie2:ListClassificationJobs`

You must manually add the above permission to the CFT template to enable it.

//The Security Audit Policy does not include the permission. 

|*Azure Monitor*

tt:[*24.6.1*]
//RLP-136333

|*azure-monitor-action-groups*

Additional permission required:

* `Microsoft.Insights/ActionGroups/Read`

The Reader role includes the permission. 

|*Azure Log Analytics*

tt:[*24.6.1*]
//RLP-120365

|*azure-log-analytics-clusters*

Additional permission required:

* `Microsoft.OperationalInsights/clusters/read`

The Reader role includes the permission. 

|*Azure App Service*

tt:[*24.6.1*]
//RLP-139922

|*azure-app-service-private-endpoint-connections*

Additional permissions required:

* `Microsoft.Web/sites/Read`
* `Microsoft.Web/sites/privateEndpointConnections/Read`

The Reader role includes the permissions. 

|*Azure Event Grid*

tt:[*24.6.1*]
//RLP-139161

|*azure-event-grid-namespaces*

Additional permission required:

* `Microsoft.EventGrid/namespaces/read`

The Reader role includes the permission. 

|*Azure Virtual Network*

tt:[*24.6.1*]
//RLP-139108

|*azure-network-private-dns-zone-groups*

Additional permissions required:

* `Microsoft.Network/privateEndpoints/read`
* `Microsoft.Network/privateEndpoints/privateDnsZoneGroups/read`

The Reader role includes the permissions. 

|*Google Storage Transfer*

tt:[*24.6.1*]
//RLP-140219

|*gcloud-storage-transfer-agent-pool*

Additional permission required:

* `storagetransfer.agentpools.list`

The Viewer role includes the permission. 

|*Google Storage Transfer*

tt:[*24.6.1*]
//RLP-140218

|*gcloud-storage-transfer-job*

Additional permission required:

* `storagetransfer.jobs.list`

The Viewer role includes the permission. 

|*Google Cloud Workstation*

tt:[*24.6.1*]
//RLP-140215

|*gcloud-cloud-workstation-configuration*

Additional permissions required:

* `workstations.workstationClusters.list`
* `workstations.workstationConfigs.list`
* `workstations.workstationConfigs.getIamPolicy`

The Viewer role includes the permissions. 

|*Google Cloud Workstation*

tt:[*24.6.1*]
//RLP-140214

|*gcloud-cloud-workstation-cluster*

Additional permission required:

* `workstations.workstationClusters.list`

The Viewer role includes the permission. 

|*Google Cloud Workstation*

tt:[*24.6.1*]
//RLP-136571

|*gcloud-cloud-workstation*

Additional permissions required:

* `workstations.workstationClusters.list`
* `workstations.workstationConfigs.list`
* `workstations.workstations.list`
* `workstations.workstationConfigs.getIamPolicy`

The Viewer role includes the permissions. 

|*GCP Vertex AI Platform Pipeline Job*

tt:[*Update*]
tt:[*24.6.1*]
//RLP-141422

|*gcloud-vertex-ai-aiplatform-pipeline-job*

A new field called runtimeConfig and it's sub-fields will be ingested as part of this update.

|===


[#new-policies]
=== New Policies

[cols="50%a,50%a"]
|===
|*Policies*
|*Description*

|*AWS Secret Manager secret not used for more than 90 days*

tt:[*24.6.1*]
//RLP-140347

|This policy identifies the AWS Secret Manager secret not accessed within 90 days.

AWS Secret Manager securely stores and manages sensitive information like API keys, passwords, and certificates. Leaving unused secrets in AWS Secret Manager increases the risk of security breaches by providing unnecessary access points for attackers, potentially leading to unauthorized data access or leaks.

It is recommended to routinely review and delete unused secrets to limit the attack surface and risk of unauthorized access.

*Policy Severity—* Informational

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-secretsmanager-describe-secret' AND json.rule = '(lastAccessedDate does not exist and _DateTime.ageInDays(createdDate) > 90) or (lastAccessedDate exists and _DateTime.ageInDays(lastAccessedDate) > 90)'
----

|*AWS Aurora MySQL DB cluster does not publish audit logs to CloudWatch Logs*

tt:[*24.6.1*]
//RLP-140387

|This policy identifies AWS Aurora MySQL DB cluster where audit logging is disabled or audit logs are not published to Amazon CloudWatch Logs.

Aurora MySQL DB cluster integrates with Amazon CloudWatch for performance metrics gathering and analysis, supporting CloudWatch Alarms. While the Aurora MySQL DB cluster provides customizable audit logs for monitoring database operations, these logs are not automatically sent to CloudWatch Logs, limiting centralized monitoring and analysis of database activities.

It is recommended to configure the Aurora MySQL DB cluster to enable audit logs and their publishing to CloudWatch. 

*Policy Severity—* Informational

*Policy Type—* Config

----
config from cloud.resource where api.name = 'aws-rds-db-cluster' AND json.rule = engine equals "aurora-mysql" and status equals "available" as X; config from cloud.resource where api.name = 'aws-rds-db-cluster-parameter-group' AND json.rule = DBParameterGroupFamily contains "aurora-mysql" as Y; filter '$.X.dBclusterParameterGroupArn equals $.Y.DBClusterParameterGroupArn and (($.Y.parameters.server_audit_logging.ParameterValue does not exist or $.Y.parameters.server_audit_logging.ParameterValue equals 0) or ($.X.enabledCloudwatchLogsExports does not contain "audit" and $.Y.parameters.server_audit_logs_upload.ParameterValue equals 0))' ; show X;
----

|*AWS AppSync GraphQL API is authenticated with API key*

tt:[*24.6.1*]
//RLP-140548

|This policy identifies the AWS AppSync Graphql API using the API key for primary or additional authentication methods.

AWS AppSync GraphQL API is a fully managed service by Amazon Web Services for building scalable and secure GraphQL APIs. An API key is a hard-coded value in your application generated by the AWS AppSync service when you create an unauthenticated GraphQL endpoint. Using API keys for authentication can pose security risks such as exposure to unauthorized access and limited control over access privileges, potentially compromising sensitive data and system integrity.

It is recommended to use authentication methods other than API Keys like IAM, Amazon Cognito User Pools, or OpenID Connect providers for securing AWS AppSync GraphQL APIs, to ensure enhanced security and access control.

*Policy Severity—* Informational

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-appsync-graphql-api' AND json.rule = authenticationType equals "API_KEY" or additionalAuthenticationProviders[?any( authenticationType equals "API_KEY" )] exists 
----

|*AWS Network Firewall is not configured with logging configuration*

tt:[*24.6.1*]
//RLP-140578

|This policy identifies an AWS Network Firewall where logging is not configured.

AWS Network Firewall manages inbound and outbound traffic for the AWS resources within the AWS environment. Logging configuration for the network firewall involves enabling logging of network traffic, including allowed and denied requests, to provide visibility into network activity. Failure to configure logging results in a lack of visibility into potential security threats, making it difficult to detect and respond to malicious activity effectively and hindering threat detection and compliance.

It is recommended to enable logging to ensure comprehensive monitoring, threat detection, compliance adherence, and effective incident response.

*Policy Severity—* Informational

*Policy Type—* Config

----
config from cloud.resource where api.name = 'aws-networkfirewall-firewall' AND json.rule = FirewallStatus.Status equals "READY" as X; config from cloud.resource where api.name = 'aws-network-firewall-logging-configuration' AND json.rule = LoggingConfiguration.LogDestinationConfigs[*].LogType does not exist as Y; filter '$.X.Firewall.FirewallArn equal ignore case $.Y.FirewallArn' ; show X;
----

|*AWS Security Hub is not enabled*

tt:[*24.6.1*]
//RLP-141035

|This policy identifies the AWS Security Hub that is not enabled in specific regions. 

AWS Security Hub is a centralized security management service by Amazon Web Services, providing a comprehensive view of your security posture and automating security checks across AWS accounts. Failure to enable AWS Security Hub in all regions may lead to limited visibility and compromised threat detection across your AWS environment.

It is recommended to enable AWS Security Hub in all regions for consistent visibility and enhanced threat detection across your AWS environment.

*Policy Severity—* Informational

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-securityhub-hub' AND json.rule = SubscribedAt exists as X; count(X) less than 1 
----

|*AWS ECS task definition logging configuration disabled*

tt:[*24.6.1*]
//RLP-138996

|This policy identifies AWS ECS task definitions that have logging configuration disabled.

AWS ECS logging involves capturing and storing container logs for monitoring, troubleshooting, and analysis purposes within the Amazon ECS environment. Collecting data from task definitions gives visibility, which can aid in debugging processes and determining the source of issues.

It is recommended to configure logging for an AWS ECS task definition.

*Policy Severity—* Informational

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-ecs-describe-task-definition' AND json.rule = status equals ACTIVE and containerDefinitions[?any(logConfiguration.logDriver does not exist)] exists
----

|*AWS EC2 Client VPN endpoints client connection logging disabled*

tt:[*24.6.1*]
//RLP-138997

|This policy identifies AWS EC2 client VPN endpoints with client connection logging disabled.

AWS Client VPN endpoints enable remote clients to securely connect to resources in the Virtual Private Cloud (VPC). Connection logs enable you to track user behaviour on the VPN endpoint and gain visibility.

It is recommended to enable connection logging for AWS EC2 client VPN endpoints.

*Policy Severity—* Low

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-ec2-client-vpn-endpoint' AND json.rule = status.code equal ignore case available and connectionLogOptions.Enabled is false
----

|*AWS EventBridge event bus with no resource-based policy attached*

tt:[*24.6.1*]
//RLP-140361

|This policy identifies AWS EventBridge event buses with no resource-based policy attached.

AWS EventBridge is a serverless event bus service that enables businesses to quickly and easily integrate applications, services, and data across multiple cloud environments. By default, an EventBridge custom event bus lacks a resource-based policy associated with it, which allows principals in the account to access the event bus. 

It is recommended to attach a resource based policy to the event bus to limit access scope to fewer entities.

*Policy Severity—* Informational

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-events-eventbus' AND json.rule = Policy does not exist
----

|*AWS WAF Rule Group CloudWatch metrics disabled*

tt:[*24.6.1*]
//RLP-140364

|This policy identifies the AWS WAF Rule Group having CloudWatch metrics disabled.

AWS WAF rule groups have CloudWatch metrics that provide information about the number of allowed and blocked web requests, counted requests, and requests that pass through without matching any rule in the rule group. These metrics can be used to monitor and analyse the performance of the web access control list (web ACL) and its associated rules.

It is recommended to enable CloudWatch metrics for a WAF rule group to help in monitoring and analysis of web requests.

*Policy Severity—* Informational

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-waf-v2-rule-group' AND json.rule = VisibilityConfig.CloudWatchMetricsEnabled is false or Rules[?any( VisibilityConfig.CloudWatchMetricsEnabled is false)] exists
----

|*AWS Step Function state machines logging disabled*

tt:[*24.6.1*]
//RLP-140365

|This policy identifies AWS Step Function state machines with logging disabled.

AWS Step Functions uses state machines to define and execute workflows that coordinate the components of distributed applications and microservices. Step Functions logs state machine executions to Amazon CloudWatch Logs for debugging and monitoring purposes.

It is recommended to enable logging on the Step Function state machine to maintain reliability, availability, and performance.

*Policy Severity—* Informational

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-step-functions-statemachine' AND json.rule = loggingConfiguration.level equal ignore case off
----

|*Azure Application Insights configured with overly permissive network access*

tt:[*24.6.1*]
//RLP-58065

|This policy identifies Application Insights configured with overly permissive network access. 

Virtual network access configuration in Application Insights allows you to restrict data ingestion and queries coming from the public networks. 

It is recommended to configure the Application Insight with virtual networks access configuration set to restrict; so that the Application Insight is accessible only to restricted Azure Monitor private link scopes.

*Policy Severity—* Medium 

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'azure' AND api.name = 'azure-application-insights-component' AND json.rule = properties.provisioningState equals Succeeded and (properties.publicNetworkAccessForQuery equals Enabled or properties.publicNetworkAccessForIngestion equals Enabled)
----

|*Azure Application Insights not configured with Azure Active Directory (Azure AD) authentication*

tt:[*24.6.1*]
//RLP-58531

|This policy identifies Application Insights that are not configured with Azure Active Directory (AAD) authentication and are enabled with local authentication. 

Disabling local authentication and using AAD-based authentication enhances the security and reliability of the telemetry used to make both critical operational and business decisions. 

It is recommended to configure the Application Insights with Azure Active Directory (AAD) authentication so that all actions are strongly authenticated.

*Policy Severity—* Medium 

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'azure' AND api.name = 'azure-application-insights-component' AND json.rule = properties.provisioningState equals Succeeded and (properties.DisableLocalAuth does not exist or properties.DisableLocalAuth is false)
----

|*Azure Log Analytics configured with overly permissive network access*

tt:[*24.6.1*]
//RLP-60227

|This policy identifies Log Analytics configured with overly permissive network access. 

Virtual network access configuration in Log Analytics allows you to restrict data ingestion and queries coming from the public networks. 

It is recommended to configure the Log Analytics with virtual networks access configuration set to restrict; so that the  Log Analytics is accessible only to restricted Azure Monitor private link scopes.

*Policy Severity—* Medium 

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'azure' AND api.name = 'azure-log-analytics-workspace' AND json.rule = properties.provisioningState equals Succeeded and (properties.publicNetworkAccessForQuery equals Enabled or properties.publicNetworkAccessForIngestion equals Enabled)
----

|*Azure storage account infrastructure encryption is disabled*

tt:[*24.6.1*]
//RLP-76220

|The policy identifies Azure storage accounts for which infrastructure encryption is disabled.

Infrastructure double encryption adds a second layer of encryption using service-managed keys. When infrastructure encryption is enabled for a storage account or an encryption scope, data is encrypted twice. Once at the service level and once at the infrastructure level - with two different encryption algorithms and two different keys. Infrastructure encryption is recommended for scenarios where double encrypted data is necessary for compliance requirements.

It is recommended to enable infrastructure encryption on Azure storage accounts so that encryption can be implemented at the layer closest to the storage device or network wires.

*Policy Severity—* Informational 

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'azure' AND api.name = 'azure-storage-account-list' AND json.rule = properties.provisioningState equal ignore case Succeeded and (properties.encryption.requireInfrastructureEncryption does not exist or properties.encryption.requireInfrastructureEncryption is false)
----

|*Azure Activity log alert for Create or update public IP address rule does not exist*

tt:[*24.6.1*]
//RLP-140569

|The policy identifies Azure storage accounts for which infrastructure encryption is disabled.

Infrastructure double encryption adds a second layer of encryption using service-managed keys. When infrastructure encryption is enabled for a storage account or an encryption scope, data is encrypted twice. Once at the service level and once at the infrastructure level - with two different encryption algorithms and two different keys. Infrastructure encryption is recommended for scenarios where double encrypted data is necessary for compliance requirements.

It is recommended to enable infrastructure encryption on Azure storage accounts so that encryption can be implemented at the layer closest to the storage device or network wires.

*Policy Severity—* Informational 

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'azure' AND api.name = 'azure-activity-log-alerts' AND json.rule = "location equal ignore case Global and properties.enabled equals true and properties.scopes[*] does not contain resourceGroups and properties.condition.allOf[?(@.field=='operationName')].equals equals Microsoft.Network/publicIPAddresses/write" as X; count(X) less than 1
----

|*Azure Activity log alert for Delete public IP address rule does not exist*

tt:[*24.6.1*]
//RLP-140572

|This policy identifies the Azure accounts in which activity log alert for Delete public IP address rule does not exist.

Creating an activity log alert for Delete public IP address rule gives insight into network rule access changes and may reduce the time it takes to detect suspicious activity. By enabling this monitoring, you get alerts whenever any deletions are made to public IP addresses rules.

As a best practice, it is recommended to have an activity log alert for Delete public IP address rule to enhance network security monitoring and detect suspicious activities.

*Policy Severity—* Informational 

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'azure' AND api.name = 'azure-activity-log-alerts' AND json.rule = "location equal ignore case Global and properties.enabled equals true and properties.scopes[*] does not contain resourceGroups and properties.condition.allOf[?(@.field=='operationName')].equals equals Microsoft.Network/publicIPAddresses/delete" as X; count(X) less than 1
----

|*GCP Vertex AI Workbench user-managed notebook auto-upgrade is disabled*

tt:[*24.6.1*]
//RLP-129289

|This policy identifies GCP Vertex AI Workbench user-managed notebooks that have auto-upgrade disabled.

Auto-upgrading Google Cloud Vertex environments ensures timely security updates, bug fixes, and compatibility with APIs and libraries. It reduces security risks associated with outdated software, enhances stability, and enables access to new features and optimizations.

It is recommended to enable auto-upgrade to minimize maintenance overhead and mitigate security risks.

*Policy Severity—* Informational

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'gcp' AND api.name = 'gcloud-vertex-ai-notebook-instance' AND json.rule = state equals "ACTIVE" and metadata.notebook-upgrade-schedule does not exist
----

|*GCP Vertex AI Workbench user-managed notebook has vTPM disabled*

tt:[*24.6.1*]
//RLP-129290

|This policy identifies GCP Vertex AI Workbench user-managed notebooks that have Virtual Trusted Platform Module (vTPM) feature disabled. 

Virtual Trusted Platform Module (vTPM) validates guest VM pre-boot and boot integrity and offers key generation and protection. The vTPM’s root keys and the keys it generates can’t leave the vTPM, thus gaining enhanced protection from compromised operating systems or highly privileged project admins.

It is recommended to enable virtual TPM device on supported virtual machines to facilitate measured Boot and other OS security features that require a TPM.

*Policy Severity—* Low

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'gcp' AND api.name = 'gcloud-vertex-ai-notebook-instance' AND json.rule = state equals "ACTIVE" and shieldedInstanceConfig.enableVtpm is false
----

|*GCP Vertex AI Workbench user-managed notebook's JupyterLab interface access mode is set to single user*

tt:[*24.6.1*]
//RLP-139231

|This policy identifies GCP Vertex AI Workbench user-managed notebooks with JupyterLab interface access mode set to single user.

Vertex AI Workbench user-managed notebook can be accessed using the web-based JupyterLab interface. Access mode controls the control access to this interface. Allowing access to only a single user could limit collaboration, increase chances of credential sharing, and hinder security audits and reviews of the resource.

It is recommended to avoid single user access and make use of the service account access mode for user-managed notebooks.

*Policy Severity—* Informational

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'aws' AND api.name = 'aws-step-functions-statemachine' AND json.rule = loggingConfiguration.level equal ignore case off
----

|*GCP Vertex AI Workbench user-managed notebook has Integrity monitoring disabled*

tt:[*24.6.1*]
//RLP-139233

|This policy identifies GCP Vertex AI Workbench user-managed notebooks that have Integrity monitoring disabled.

Integrity Monitoring continuously monitors the boot integrity, kernel integrity, and persistent data integrity of the underlying VM of the shielded user-managed notebooks. It detects unauthorized modifications or tampering, enhancing security by verifying the trusted state of VM components throughout their lifecycle. It provides active alerting allowing administrators to respond to integrity failures and prevent compromised nodes from being deployed into the cluster.

It is recommended to enable integrity monitoring for user-managed notebooks to detect and mitigate advanced threats like rootkits and bootkit malware.

*Policy Severity—* Low

*Policy Type—* Config

----
config from cloud.resource where cloud.type = 'gcp' AND api.name = 'gcloud-vertex-ai-notebook-instance' AND json.rule = state equals "ACTIVE" and shieldedInstanceConfig.enableIntegrityMonitoring is false 
----

|*GCP Cloud Run service revision is using default service account with editor role*

tt:[*24.6.1*]
//RLP-140681

|This policy identifies GCP Cloud Run service revisions that are utilizing the default service account with the editor role. 

GCP Compute Engine Default service account is automatically created upon enabling the Compute Engine API. This service account is granted the IAM basic Editor role by default, unless explicitly disabled. Assigning default service account with the editor role to cloud run revisions could lead to privilege escalation. Granting minimal access rights helps in promoting a better security posture.

Following the principle of least privileges, it is recommended to avoid assigning default service account with the editor role to cloud run revision.

*Policy Severity—* Medium

*Policy Type—* Config

----
config from cloud.resource where api.name = 'gcloud-projects-get-iam-user' AND json.rule = user contains "compute@developer.gserviceaccount.com" and roles[*] contains "roles/editor" as X; config from cloud.resource where api.name = 'gcloud-cloud-run-revisions-list' AND json.rule = spec.serviceAccountName contains "compute@developer.gserviceaccount.com" as Y; filter ' $.X.user equals $.Y.spec.serviceAccountName '; show Y;
----

|*OCI Cloud Guard is not enabled in the root compartment of the tenancy*

tt:[*24.6.1*]
//RLP-140442

|This policy identifies the absence of OCI Cloud Guard enablement in the root compartment of the tenancy.

OCI Cloud Guard is a vital service that detects misconfigured resources and insecure activities within an OCI tenancy. It offers security administrators visibility to identify and resolve these issues promptly. Cloud Guard not only detects but also suggests, assists, or takes corrective actions to mitigate security risks. By enabling Cloud Guard in the root compartment of the tenancy with default configuration, activity detectors, and responders, administrators can proactively monitor and secure their OCI resources against potential security threats.

As best practice, it is recommended to have Cloud Guard enabled in the root compartment of your tenancy.

*Policy Severity—* Informational

*Policy Type—* Config

----
config from cloud.resource where api.name = 'oci-cloudguard-configuration' AND json.rule = status does not equal ignore case ENABLED
----

|*OCI boot volume is not encrypted with Customer Managed Key (CMK)*

tt:[*24.6.1*]
//RLP-140443

|This policy identifies OCI boot volumes that are not encrypted with a Customer Managed Key (CMK).

Encrypting boot volumes with a CMK enhances data security by providing an additional layer of protection. Effective management of encryption keys is crucial for safeguarding and accessing sensitive data. Customers should review boot volumes encrypted with Oracle service managed keys to determine if they prefer managing keys for specific volumes and implement their own key lifecycle management accordingly.

As best practice, it is recommended to encrypt OCI boot volumes using a Customer Managed Key (CMK) to strengthen data security measures.

*Policy Severity—* Informational

*Policy Type—* Config

----
config from cloud.resource where api.name = 'oci-block-storage-boot-volume' AND json.rule = lifecycleState equal ignore case "AVAILABLE" AND kmsKeyId is member of ("null")
----

|===

[#iam-policies]
=== IAM Policies

The 24.6.1 release includes the following OOTB IAM policies:

//RLP-139907

[cols="20%a,30%a,30%a,10%a,10%a"]

|===
|*Policy Name*
|*Description*
|*RQL*
|*Cloud*
|*Policy Severity*

|*AWS Compute Instance (EC2/Lambda) Assigned CloudFormation Creation Permissions Which Could Lead to Privilege Escalation*
|An adversary able to create CloudFormation stacks with any role would be able to escalate their permissions by attaching a privileged role to the stack while influencing the actions taken by the created resources. As such, they would obtain the ability to perform actions using the permissions of the attached role, allowing further enumeration and exploitation of the environment.
|----
config from iam where dest.cloud.type = 'AWS' AND action.name CONTAINS ALL ('iam:PassRole', 'cloudformation:CreateStack') AND source.cloud.resource.type IN ('instance', 'function')
----
|AWS
|High

|*AWS Compute Instance (EC2/Lambda) Assigned Permissions to Run EC2 Instances Which Could Lead to Privilege Escalation*
|An adversary able to run EC2 instances with any role would be able to escalate their permissions by attaching a privileged role to the instance. As such, they would obtain the permissions of the role attached to the EC2, allowing further enumeration and exploitation of the environment.
|----
config from iam where dest.cloud.type = 'AWS' AND action.name CONTAINS ALL ('iam:PassRole', 'ec2:RunInstances') AND source.cloud.resource.type IN ('instance', 'function')
----
|AWS
|High

|*AWS Compute Instance (EC2/Lambda) Assigned Lambda Creation Permissions Which Could Lead to Privilege Escalation*
|An adversary able to create a Lambda Function with any role and give themselves the permissions to invoke it would be able to escalate their permissions by attaching a privileged role to the function while defining the Lambda's actions. As such, they would obtain the ability to perform actions using the permissions of the attached role, allowing further enumeration and exploitation of the environment.
|----
config from iam where dest.cloud.type = 'AWS' AND action.name CONTAINS ALL ('iam:PassRole', 'lambda:CreateFunction', 'lambda:AddPermission') AND source.cloud.resource.type IN ('instance', 'function')
----
|AWS
|High

|*AWS Compute Instance (EC2/Lambda) Assigned IAM Policy Management Permissions Which Could Lead to Privilege Escalation*
|An adversary able to influence or change IAM policies could grant themselves extensive permissions using the policies. As such, they would obtain the ability to perform actions allowed by the policies, allowing further enumeration and exploitation of the environment.
|----
config from iam where dest.cloud.type = 'AWS' AND action.name in ('iam:PutGroupPolicy', 'iam:PutRolePolicy', 'iam:AttachGroupPolicy', 'iam:AttachUserPolicy', 'iam:CreatePolicyVersion') AND source.cloud.resource.type IN ('instance', 'function')
----
|AWS
|High

|*AWS Compute Instance (EC2/Lambda) Assigned Glue DevEndpoint Creation Permissions Which Could Lead to Privilege Escalation*
|An adversary able to create a Glue DevEndpoint with any role would be able to escalate their permissions by attaching a privileged role to the endpoint and configuring authentication to the endpoint using a key which they control. As such, they would obtain the ability to perform actions using the permissions of the attached role, allowing further enumeration and exploitation of the environment.
|----
config from iam where dest.cloud.type = 'AWS' AND action.name CONTAINS ALL ('iam:PassRole', 'glue:CreateDevEndpoint') AND source.cloud.resource.type IN ('instance', 'function')
----

|AWS
|High

|*AWS Compute Instance (EC2/Lambda) Assigned Glue DevEndpoint Creation Permissions Which Could Lead to Privilege Escalation*
|An adversary able to create a Glue DevEndpoint with any role would be able to escalate their permissions by attaching a privileged role to the endpoint and configuring authentication to the endpoint using a key which they control. As such, they would obtain the ability to perform actions using the permissions of the attached role, allowing further enumeration and exploitation of the environment.
|----
config from iam where dest.cloud.type = 'AWS' AND action.name CONTAINS ALL ('iam:PassRole', 'glue:CreateDevEndpoint') AND source.cloud.resource.type IN ('instance', 'function')
----
|AWS
|High

|*Azure Compute Resource Assigned Role & Role Assignment Related Permissions Which Could Lead to Privilege Escalation*

|An adversary able to edit role assignments or role definitions could grant themselves additional roles, or grant additional permissions to roles they already have access to, escalating their privileges within the environment. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'AZURE' AND source.cloud.type = 'AZURE' AND source.cloud.service.name = 'Microsoft.Compute' AND source.cloud.resource.type = 'VirtualMachines' and action.name IN ('Microsoft.Authorization/roleAssignments/write', 'Microsoft.Authorization/roleDefinitions/write')
----
|Azure
|High


|*Azure Compute Resource Assigned Managed Identity Assignment Permissions Which Could Lead to Privilege Escalation*

|An adversary able to assign managed identities could assign them to themselves, obtaining the additional permissions granted to the managed identity, escalating their privileges within the environment. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'AZURE' AND source.cloud.type = 'AZURE' AND source.cloud.service.name = 'Microsoft.Compute' AND source.cloud.resource.type = 'VirtualMachines' and action.name = 'Microsoft.ManagedIdentity/userAssignedIdentities/assign/action'
----
|Azure
|High

|*AWS Role With Administrative Permissions Can Be Assumed By All Users*
|A globally assumable role with administartive permissions could allow an adversary to assume it (regardless of their original role as the target role is globally assumable) and utilize its administrative permissions to further compromise the environment.
|----
config from iam where source.public = true AND grantedby.cloud.entity.type='role' and action.access.isAdministrative = true
----
|AWS
|High

|*GCP Compute Instance (VM/Cloud Function) Assigned Cloud Function Creation Permissions Which Could Lead to Privilege Escalation*
|An adversary able to create Cloud Function instances with Service Account impersonation privileges would be able to escalate their permissions creating an instance which performs attacker controlled actions using the permissions of an impersonated Service Account. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.resource.type IN ('Instances', 'functions') AND action.name CONTAINS ALL ( 'cloudfunctions.functions.create', 'cloudfunctions.functions.sourceCodeSet', 'iam.serviceAccounts.actAs' )
----
|GCP
|High

|*GCP Compute Instance (VM/Cloud Function) Assigned Cloud Run Creation Permissions Which Could Lead to Privilege Escalation*
|An adversary able to create Cloud Run instances with Service Account impersonation privileges would be able to escalate their permissions creating an instance which performs attacker controlled actions using the permissions of an impersonated Service Account. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.resource.type IN ('Instances', 'functions') AND action.name CONTAINS ALL ( 'run.services.create', 'run.routes.invoke', 'iam.serviceAccounts.actAs' )
----
|GCP
|High

|*GCP Compute Instance (VM/Cloud Function) Assigned Cloud Function IAM Policy Edit Permissions Which Could Lead to Privilege Escalation*
|An adversary able to edit the IAM policy for Cloud Function instances, in conjunction with Service Account impersonation privileges would be able to escalate their permissions by adding edit permissions to an instance, causing it to perform attacker controlled actions using the permissions of an impersonated Service Account. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.resource.type IN ('Instances', 'functions') AND action.name CONTAINS ALL ( 'cloudfunctions.functions.setIamPolicy', 'iam.serviceAccounts.actAs' )
----
|GCP
|High

|*GCP Compute Instance (VM/Cloud Function) Assigned Cloud Run IAM Policy Edit Permissions Which Could Lead to Privilege Escalation*
|An adversary able to edit the IAM policy for Cloud Run instances, in conjunction with Service Account impersonation privileges would be able to escalate their permissions by adding edit permissions to an instance, causing it to perform attacker controlled actions using the permissions of an impersonated Service Account. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.resource.type IN ('Instances', 'functions') AND action.name CONTAINS ALL ( 'run.services.setIamPolicy', 'iam.serviceAccounts.actAs' )
----
|GCP
|High

|*GCP Compute Instance (VM/Cloud Function) Assigned Cloud Run Jobs IAM Policy Edit Permissions Which Could Lead to Privilege Escalation*
|An adversary able to edit the IAM policy for Cloud Run Jobs, in conjunction with Service Account impersonation privileges would be able to escalate their permissions by adding edit permissions to an instance, causing it to perform attacker controlled actions using the permissions of an impersonated Service Account. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.resource.type IN ('Instances', 'functions') AND action.name CONTAINS ALL ( 'run.jobs.setIamPolicy', 'iam.serviceAccounts.actAs' )
----
|GCP
|High

|*GCP Compute Instance (VM/Cloud Function) Assigned IAM Role Update Permissions Which Could Lead to Privilege Escalation*

|An adversary able to retrieve and edit IAM roles could grant themselves additional permissions within the environment, escalating their privileges. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.resource.type IN ('Instances', 'functions') AND action.name CONTAINS ALL ( 'iam.roles.update', 'iam.roles.get' )
----
|GCP
|High

|*GCP Compute Instance (VM/Cloud Function) Assigned Permissions to Retrieve Service Account Tokens Which Could Lead to Privilege Escalation*
|An adversary able to retrieve Service Account tokens could authenticate as high-privileged Service Accounts, escalating their original privileges. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.resource.type IN ('Instances', 'functions') AND action.name CONTAINS ALL ( 'iam.serviceAccounts.getAccessToken', 'iam.serviceAccounts.get' )
----
|GCP
|High

|*GCP Compute Instance (VM/Cloud Function) Assigned Permissions to Edit IAM Policy for Service Accounts Which Could Lead to Privilege Escalation*
|An adversary able to edit Service Accounts' IAM Policies could grant themselves additional permissions within the environment, escalating their privileges. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.resource.type IN ('Instances', 'functions') AND action.name = 'iam.serviceAccounts.setIamPolicy'
----
|GCP
|High


|*GCP Compute Instance (VM/Cloud Function) Assigned Resource Manager Permissions Which Could Lead to Privilege Escalation*
|An adversary able to edit IAM Policies at the organization, folder or project levels could grant themselves additional permissions within the environment, escalating their privileges. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.resource.type IN ('Instances', 'functions') AND action.name IN ('resourcemanager.organizations.setIamPolicy', 'resourcemanager.folders.setIamPolicy', 'resourcemanager.projects.setIamPolicy')
----
|GCP
|High

|*GCP Cloud Run Instance Assigned Cloud Function Creation Permissions Which Could Lead to Privilege Escalation*
|An adversary able to create Cloud Function instances with Service Account impersonation privileges would be able to escalate their permissions creating an instance which performs attacker controlled actions using the permissions of an impersonated Service Account. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'run' AND action.name CONTAINS ALL ( 'cloudfunctions.functions.create', 'cloudfunctions.functions.sourceCodeSet', 'iam.serviceAccounts.actAs' )
----
|GCP
|High

|*GCP Cloud Run Instance Assigned Cloud Run Creation Which Could Lead to Privilege Escalation*
|An adversary able to create Cloud Run instances with Service Account impersonation privileges would be able to escalate their permissions creating an instance which performs attacker controlled actions using the permissions of an impersonated Service Account. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'run' AND action.name CONTAINS ALL ( 'run.services.create', 'run.routes.invoke', 'iam.serviceAccounts.actAs' )
----
|GCP
|High

|*GCP Cloud Run Instance Assigned Cloud Function IAM Policy Edit Permissions Which Could Lead to Privilege Escalation*

|An adversary able to edit the IAM policy for Cloud Function instances, in conjunction with Service Account impersonation privileges would be able to escalate their permissions by adding edit permissions to an instance, causing it to perform attacker controlled actions using the permissions of an impersonated Service Account. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'run' AND action.name CONTAINS ALL ( 'cloudfunctions.functions.setIamPolicy', 'iam.serviceAccounts.actAs' )
----
|GCP
|High

|*GCP Cloud Run Instance Assigned Cloud Run IAM Policy Edit Permissions Which Could Lead to Privilege Escalation*
|An adversary able to edit the IAM policy for Cloud Run instances, in conjunction with Service Account impersonation privileges would be able to escalate their permissions by adding edit permissions to an instance, causing it to perform attacker controlled actions using the permissions of an impersonated Service Account. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'run' AND action.name CONTAINS ALL ( 'run.services.setIamPolicy', 'iam.serviceAccounts.actAs' )
----
|GCP
|High

|*GCP Cloud Run Instance Assigned Cloud Run Jobs IAM Policy Edit Permissions Which Could Lead to Privilege Escalation*
|An adversary able to edit the IAM policy for Cloud Run Jobs, in conjunction with Service Account impersonation privileges would be able to escalate their permissions by adding edit permissions to an instance, causing it to perform attacker controlled actions using the permissions of an impersonated Service Account. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'run' AND action.name CONTAINS ALL ( 'run.jobs.setIamPolicy', 'iam.serviceAccounts.actAs' )
----
|GCP
|High

|*GCP Cloud Run Instance Assigned IAM Role Update Permissions Which Could Lead to Privilege Escalation*
|An adversary able to retrieve and edit IAM roles could grant themselves additional permissions within the environment, escalating their privileges. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'run' AND action.name CONTAINS ALL ( 'iam.roles.update', 'iam.roles.get' )
----
|GCP
|High

|*GCP Cloud Run Instance Assigned Permissions to Retrieve Service Account Tokens Which Could Lead to Privilege Escalation*
|An adversary able to retrieve Service Account tokens could authenticate as high-privileged Service Accounts, escalating their original privileges. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'run' AND action.name CONTAINS ALL ( 'iam.serviceAccounts.getAccessToken', 'iam.serviceAccounts.get' )
----
|GCP
|High

|*GCP Cloud Run Instance Assigned Permissions to Edit IAM Policy for Service Accounts Which Could Lead to Privilege Escalation*
|An adversary able to edit Service Accounts' IAM Policies could grant themselves additional permissions within the environment, escalating their privileges. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'run' AND action.name = 'iam.serviceAccounts.setIamPolicy'
----
|GCP
|High

|*GCP Cloud Run Instance Assigned Resource Manager Permissions Which Could Lead to Privilege Escalation*
|An adversary able to edit IAM Policies at the organization, folder or project levels could grant themselves additional permissions within the environment, escalating their privileges. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'run' AND action.name IN ('resourcemanager.organizations.setIamPolicy', 'resourcemanager.folders.setIamPolicy', 'resourcemanager.projects.setIamPolicy')
----
|GCP
|High

|*GCP App Engine Web Service Assigned Cloud Function Creation Permissions Which Could Lead to Privilege Escalation*
|An attacker who successfully exploits a vulnerability or misconfiguration in the web service can leverage the permissions associated with the App Engine service. By creating Cloud Function instances with service account impersonation privileges, the attacker can escalate their permissions. This enables the creation of instances that perform actions under the guise of the impersonated service account, further allowing the attacker to enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'appengine' AND action.name CONTAINS ALL ( 'cloudfunctions.functions.create', 'cloudfunctions.functions.sourceCodeSet', 'iam.serviceAccounts.actAs' )
----
|GCP
|High

|*GCP App Engine Web Service Assigned Cloud Run Creation Which Could Lead to Privilege Escalation*
|An attacker who successfully exploits a vulnerability or misconfiguration in the web service can leverage the permissions associated with the App Engine service. By creating Cloud Run instances with Service Account impersonation privileges they would be able to escalate their permissions creating an instance which performs attacker controlled actions using the permissions of an impersonated Service Account. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'appengine' AND action.name CONTAINS ALL ( 'run.services.create', 'run.routes.invoke', 'iam.serviceAccounts.actAs' )
----
|GCP
|High

|*GCP App Engine Web Service Assigned Cloud Function IAM Policy Edit Permissions Which Could Lead to Privilege Escalation*
|An attacker who successfully exploits a vulnerability or misconfiguration in the web service can leverage the permissions associated with the App Engine service. By editing the IAM policy for Cloud Function instances, in conjunction with Service Account impersonation privileges they would be able to escalate their permissions by adding edit permissions to an instance, causing it to perform attacker controlled actions using the permissions of an impersonated Service Account. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'appengine' AND action.name CONTAINS ALL ( 'cloudfunctions.functions.setIamPolicy', 'iam.serviceAccounts.actAs' )
----
|GCP
|High

|*GCP App Engine Web Service Assigned Cloud Run IAM Policy Edit Permissions Which Could Lead to Privilege Escalation*
|An attacker who successfully exploits a vulnerability or misconfiguration in the web service can leverage the permissions associated with the App Engine service. By editing the IAM policy for Cloud Run instances, in conjunction with Service Account impersonation privileges they would be able to escalate their permissions by adding edit permissions to an instance, causing it to perform attacker controlled actions using the permissions of an impersonated Service Account. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'appengine' AND action.name CONTAINS ALL ( 'run.services.setIamPolicy', 'iam.serviceAccounts.actAs' )
----
|GCP
|High

|*GCP App Engine Web Service Assigned Cloud Run Jobs IAM Policy Edit Permissions Which Could Lead to Privilege Escalation*
|An attacker who successfully exploits a vulnerability or misconfiguration in the web service can leverage the permissions associated with the App Engine service. By editing the IAM policy for Cloud Run Jobs, in conjunction with Service Account impersonation privileges they will be able to escalate their permissions by adding edit permissions to an instance, causing it to perform attacker controlled actions using the permissions of an impersonated Service Account. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'appengine' AND action.name CONTAINS ALL ( 'run.jobs.setIamPolicy', 'iam.serviceAccounts.actAs' )
----
|GCP
|High

|*GCP App Engine Web Service Assigned IAM Role Update Permissions Which Could Lead to Privilege Escalation*
|An attacker who successfully exploits a vulnerability or misconfiguration in the web service can leverage the permissions associated with the App Engine service. With the ability to retrieve and edit IAM roles could grant themselves additional permissions within the environment, escalating their privileges. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'appengine' AND action.name CONTAINS ALL ( 'iam.roles.update', 'iam.roles.get' )
----
|GCP
|High

|*GCP App Engine Web Service Assigned Permissions to Retrieve Service Account Tokens Which Could Lead to Privilege Escalation*

|An attacker who successfully exploits a vulnerability or misconfiguration in the web service can leverage the permissions associated with the App Engine service. With the ability to retrieve Service Account tokens could authenticate as high-privileged Service Accounts, escalating their original privileges. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'appengine' AND action.name CONTAINS ALL ( 'iam.serviceAccounts.getAccessToken', 'iam.serviceAccounts.get' )
----
|GCP
|High

|*GCP App Engine Web Service Assigned Permissions to Edit IAM Policy for Service Accounts Which Could Lead to Privilege Escalation*
|An attacker who successfully exploits a vulnerability or misconfiguration in the web service can leverage the permissions associated with the App Engine service. With the ability to edit Service Accounts' IAM Policies they could grant themselves additional permissions within the environment, escalating their privileges. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'appengine' AND action.name = 'iam.serviceAccounts.setIamPolicy'
----
|GCP
|High

|*GCP App Engine Web Service Assigned Resource Manager Permissions Which Could Lead to Privilege Escalation*
|An attacker who successfully exploits a vulnerability or misconfiguration in the web service can leverage the permissions associated with the App Engine service. With the ability to edit IAM Policies at the organization, folder or project levels they can grant themselves additional permissions within the environment, escalating their privileges. This would allow them to further enumerate and exploit the environment.
|----
config from iam where dest.cloud.type = 'GCP' AND source.cloud.service.name = 'appengine' AND action.name IN ('resourcemanager.organizations.setIamPolicy', 'resourcemanager.folders.setIamPolicy', 'resourcemanager.projects.setIamPolicy')
----
|GCP
|High


|===


[#new-compliance-benchmarks-and-updates]
=== New Compliance Benchmarks and Updates

[cols="50%a,50%a"]
|===
|*Compliance Benchmark*
|*Description*

|*Support for CIS GKE v1.5*
//RLP-140371

|Prisma Cloud now supports CIS GKE version 1.5. The latest version has new controls and new Prisma cloud policies are mapped to the controls increasing the overall coverage.

You can view this built-in standard and the associated policies on *Compliance > Standards*. Generate reports for immediate viewing or download, or schedule recurring reports to track this compliance standard over time.


|*Support for CIS OCI v2.0*
//RLP-140367

|Prisma Cloud now supports CIS OCI version 2.0. The latest version has new controls and new Prisma cloud policies are mapped to the controls increasing the overall coverage.

You can view this built-in standard and the associated policies on *Compliance > Standards*. Generate reports for immediate viewing or download, or schedule recurring reports to track this compliance standard over time.


|*Support for CIS Azure Foundation benchmark v2.1*
//RLP-140362

|Prisma Cloud now supports CIS Azure Foundation benchmark version 2.1. The latest version has new controls and new Prisma cloud policies are mapped to the controls increasing the overall coverage.

You can view this built-in standard and the associated policies on *Compliance > Standards*. Generate reports for immediate viewing or download, or schedule recurring reports to track this compliance standard over time.

|*Support for CIS AWS Foundation benchmark 3.0*
//RLP-140359

|Prisma Cloud now supports CIS AWS Foundation Benchmark version 3.0. This latest version has new controls and new Prisma cloud policies are mapped to the controls increasing the overall coverage.

You can now view this built-in standard and the associated policies on the *Compliance > Standards* page. Generate reports for immediate viewing or download, or schedule recurring reports to track this compliance standard over time.

|===

[#rest-api-updates]
=== REST API Updates

[cols="37%a,63%a"]
|===
|*Change*
|*Description*

|*IAM APIs*
//RLP-141016

|Get least privilege access suggestions and resource metadata with the following new APIs:

* Get least Privilege Access Metadata of a Resource - https://pan.dev/prisma-cloud/api/cspm/least-privilege-access-metadata-by-resource-v-1/[GET iam/api/v1/resources/:resourceId/over-permissive-metadata]
* Get existing Least Privilege Access Suggestions for a Resource - https://pan.dev/prisma-cloud/api/cspm/existing-least-privilege-access-by-resource-v-1/[GET iam/api/v1/resources/:resourceId/existing-least-privileged-access]
* Get new Least Privilege Access Suggestions for a Resource - https://pan.dev/prisma-cloud/api/cspm/custom-least-privilege-access-by-resource-v-1/[GET iam/api/v1/resources/:resourceId/custom-least-privileged-access]

|*CDEM APIs*
//RLP-133711

|Obtain a list of vulnerabilities and details of distros affected by a vulnerability with the following new CDEM endpoints:

* Get Vulnerabilities of Unmanaged Asset - https://pan.dev/prisma-cloud/api/cspm/asset-vulnerability/[GET /asm/api/v1/asset/{asset_id}/vulnerability]
* Get Impacted Distros of a Vulnerability - https://pan.dev/prisma-cloud/api/cspm/vulnerability/[GET /asm/api/v1/asset/vulnerability]

|*Cloud Discovery and Exposure Management (CDEM) APIs*
//RLP-133711

|*New Endpoints*:
The following endpoints are now available to fetch vulnerability details, distributions impacted by a vulnerability, and snooze patterns:

* Get Vulnerabilities of Unmanaged Asset - https://pan.dev/prisma-cloud/api/cspm/asset-vulnerability/[GET /asm/api/v1/asset/{asset_id}/vulnerability]
* Get Impacted Distros of a Vulnerability - https://pan.dev/prisma-cloud/api/cspm/vulnerability/[GET /asm/api/v1/asset/vulnerability]
* Get Snooze Regex Pattern - https://pan.dev/prisma-cloud/api/cspm/list-snoozed-pattern/[GET asm/api/v1/asset/snoozed-regex]

*Updates to the existing Endpoints*:

Introducing support to snooze or unsnooze a set of assets that match a regular expression by adding the *regex* parameter in the following endpoints:

* Snooze Unmanaged Assets - https://pan.dev/prisma-cloud/api/cspm/asset-snooze/[POST asm/api/v1/asset/snooze]
* Unsnooze Unmanaged Assets - https://pan.dev/prisma-cloud/api/cspm/asset-unsnooze/[POST asm/api/v1/asset/reopen]

You can now filter assets by the account mapping status, which indicates if the asset is associated with a parent account on Prisma Cloud. The *accountMappingStatus* parameter is now added to the request or response of the following endpoints:

* Get Assets List - https://pan.dev/prisma-cloud/api/cspm/asset-inventory-for-l-3/[GET asm/api/v1/asset]
* Get Asset Filters - https://pan.dev/prisma-cloud/api/cspm/get-asset-filters/[GET asm/api/v1/asset/filters]
* Get Aggregated Asset Count by Asset Type - https://pan.dev/prisma-cloud/api/cspm/get-asset-count-by-asset-type-for-l-2/[GET asm/api/v1/asset/aggregation-by-resource-type]
* Get Aggregated Asset Count by Cloud Type - https://pan.dev/prisma-cloud/api/cspm/get-assets-aggregated-by-provider-for-l-1/[GET asm/api/v1/asset/aggregation-by-cloud-type]


|*Vulnerabilities Dashboard (UVE) APIs*
//RLP-142165

|*New Endpoints*:
The following new versions of the existing endpoints are introduced to fetch additional details about the vulnerabilities:

* Get Prioritized Vulnerabilities V3 - https://pan.dev/prisma-cloud/api/cspm/prioritised-vulnerability-v-3/[GET uve/api/v3/dashboard/vulnerabilities/prioritised]
* Get Top Impacting Vulnerabilities V2 - https://pan.dev/prisma-cloud/api/cspm/top-prioritised-vulnerability-v-2/[GET uve/api/v2/dashboard/vulnerabilities/prioritised-vuln]
* Get CVE Overview V2 - https://pan.dev/prisma-cloud/api/cspm/cve-overview-v-2/[GET uve/api/v1/cve-overview]

*Updates to the existing Endpoints*:

* The EPSS score and its details are added to the response to the following endpoints:

** Get Vulnerabilities by RQL - https://pan.dev/prisma-cloud/api/cspm/vulnerabilities-search-api/[GET uve/api/v1/vulnerabilities/search]
** Get CVE Overview - https://pan.dev/prisma-cloud/api/cspm/cve-overview/[GET uve/api/v1/dashboard/vulnerabilities/cve-overview]

The *atRisk* and *internetExposed* parameters are added to the response of Get Vulnerable Assets by RQL 
* https://pan.dev/prisma-cloud/api/cspm/list-vulnerable-assets/[GET uve/api/v1/vulnerabilities/search/asset] endpoint.


|===


[#deprecation-notices]
=== Deprecation Notices

[cols="35%a,10%a,10%a,45%a"]
|===

|*Deprecated Endpoints or Parameters*
|*Deprecated Release*
|*Sunset Release*
|*Replacement Endpoints*

|*End of support for Azure Data Lake Analytics and Azure Data Lake Storage Gen1 Services*

//RLP-134902, RLP-127361

|N/A
|24.6.1

|The following APIs are planned for deprecation because Azure has announced the retirement of Azure Data Lake Analytics and Azure Data Lake Storage Gen1 Services. Due to this, Prisma Cloud will no longer ingest metadata for the following APIs:

* azure-data-lake-analytics-account
* azure-data-lake-analytics-diagnostic-settings
* azure-data-lake-store-gen1-account
* azure-data-lake-store-gen1-diagnostic-settings

In RQL, the key will not be available in the `api.name` attribute auto-completion.

*Impact*—If you have a saved search or custom policies based on this API, you must delete those manually. The policy alerts will be resolved as Policy_Deleted.

|===