== Integrated API Endpoints Visibility

As you xref:../connect/connect/connect-cloud-accounts/connect-cloud-accounts.adoc[Connect your Cloud Accounts], Prisma Cloud provides a continous and automated discovery of all the API endpoints in your deployment. This discovery helps you to prioritize the risks and understand your security posture and attack vector.

**Sources of API Discovery**

Prisma Cloud uses existing WAAS runtime rules (agent-based and agentless) to scan traffic and AWS API Gateway configurations within your deployment to list the API Endpoints on *Inventory > API Endpoints*.
//P2 (early Nov)- Automatic Agentless WAAS discovery without any configurations. Enable *Web & API Security*

//P2 - *Collections > Cloud Security > Settings > Providers > Cloud Accounts > WAAS API Scanning
This page helps you to: 

* Discover all the API endpoints in your workloads, do a risk assessment, and enforce WAAS protection policies.
** Find where are the risky API endpoints in your deployment and in which Cloud account.
** Assess the services in your Cloud account that have risky API endpoints.
** Spot a shadow API with sensitive data and with lack of authentication.
* Assess the risk indicators of discovered APIs.
* Enforce xref:../runtime-security/waas/deploy-waas/deploy-waas.adoc[WAAS protection rules] on your workload.

=== Discover and Monitor API Endpoints

**Prerequisites*:

* Enable *Agentless Workload Scanning* as you xref:../connect/connect-cloud-accounts/connect-cloud-accounts.adoc[Connect Cloud Accounts].
//P2 (early Nov)* Enable *Web & API Security* at the time you xref:../connect/connect-cloud-accounts/connect-cloud-accounts.adoc[Connect Cloud Accounts]. This is for automated Agentless Discovery - only for AWS
//<TBD> - update the toggle in cloud account platform page.

image::cloud-and-software-inventory/inventory-api-endpoints.png[]

The *Inventory > API Endpoints* gives insights such as, the URL Path, the HTTP method, the assets relationship, services, Cloud accounts, risk factors, the workload the API endpoints are associated with, and the discovery method.

You can group the discovered endpoints by Cloud type, service name, region, workload, and server either in a Cards view or a Table view.
Out of all the discovered endpoints, you can search and filter on various parameters, say for example show all the internet exposed endpoints, endpoints with sensitive data, the HTTP methods, and recently changed/observed API endpoints.
//Discovery method: Traffic Inspection and Cloud config

[#api-risk-profiling]
=== API Risk Profiling and Findings

Select an API Endpoint to understand its findings for risk assessment.

<gif>

The API risk profiling gives you insights on the attack path, the audit trail, alerts profiles and the policies violated, findings, vulnerabilities and the risk factors indicators, and relationship of this endpoint with other assets in your workload.

The risk factors help you to identify internet exposed API endpoints, endpoints detected with OWASP risks, endpoints that do not require authentication to be accessed, and the sensitive data transmitted to this endpoint, and the sensitive data returned by the server.

//Show and explain the attack paths with an example?
//Today we show the attack path on the host and not on the API endpoint.
xref:../runtime-security/waas/
Refer to 
https://docs.paloaltonetworks.com/prisma/prisma-cloud/31/prisma-cloud-compute-edition-admin/waas/waas_api_discovery#:~:text=Path%20risks%20profiling[API Discovery - Path risks profiling] for more details.

[.task]
=== Investigate API Endpoints

The WAAS integration in platform also enable you to easily search and investigate the WAAS assets.
Say for example, show me all the asset types of API Endpoints, where the finding name has some injections.

[.procedure]

. Go to *Investigate > Search*.
. Run the query with the following query attributes and values:
+
FIND: Asset
+
Asset Type: API Endpoint
+
WHERE: Finding Name in "injection"

. Select *Search*.
+
<gif-env-not-ready> //no data
+
You can see the endpoints and the associated findings. For example highligh a SQL injection Web attack and only see the endpoints affected by this attack.
+
You can further click on an endpoint and *View Details* of the attack findings. 

=== What's Next

Once you onboard your Cloud accounts and assess the attack vector, you can now set WAAS rules to enforce policies on these discovered endpoints, trigger WAAS events to generate alerts when the rules are violated, and take informed decisions to protect your applications.
Refer to xref:../runtime-security/waas/deploy-waas/deploy-waas.adoc[Deploy WAAS].