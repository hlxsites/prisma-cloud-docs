== Azure Kubernetes Cluster (AKS) Nodes Don't Limit the Maximum Pods to Greater than 50
// Ensure Azure Kubernetes Cluster (AKS) nodes should use a minimum number of 50 pods.

=== Rule Details

[cols="1,2"]
|===
|Cortex AppSec Rule ID |APPSEC_AZURE_168
|Category |Compute-Over-provisioned
|Provider |AZURE
|Severity |LOW
|Framework |Terraform, Terraform Plan, ARM, Bicep
|Mapped CSPM/KSPM Rule |None
|===


=== Fix - Buildtime

*Terraform*

* *Resource:* azurerm_kubernetes_cluster, azurerm_kubernetes_cluster_node_pool
* *Arguments:* max_pods

[source,terraform]
----
resource "azurerm_kubernetes_cluster" "example" {
  name                = "example-aks"
  location            = azurerm_resource_group.example.location
  resource_group_name = azurerm_resource_group.example.name

  default_node_pool {
    name       = "default"
+   max_pods   = 50
  }

  tags = {
    Environment = "dev"
  }
}

# OR For separate node pool

resource "azurerm_kubernetes_cluster_node_pool" "example" {
  name                  = "example"
  kubernetes_cluster_id = azurerm_kubernetes_cluster.example.id
+ max_pods              = 50
}
----
