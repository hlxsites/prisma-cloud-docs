== Azure Activity Log retention should not be set to less than 365 days
// Activity Log retention less than 365 days


=== Rule Details

[cols="1,3"]
|===
|Cortex AppSec Rule ID |APPSEC_AZURE_37
|Category |LOGGING-RETENTION
|Provider |AZURE
|Severity |LOW
|Framework |ARM, Terraform, Bicep, Terraform Plan
|Mapped CSPM/KSPM Rule |700e9da9-b460-41f7-a4c6-b38cc9fcf588
|===


=== Description 


A log profile controls how the activity log is exported and retained.
Since the average time to detect a breach is 210 days, the activity log should be retained for 365 days or more, providing time to respond to any incidents.
We recommend you set activity log retention for 365 days or greater.
////
=== Fix - Runtime


* Azure Portal To change the policy using the Azure Portal, follow these steps:* 



. Log in to the Azure Portal at https://portal.azure.com.

. Navigate to the * Activity log*.

. Select * Export*.

. Set * Retention (days)* to * 365* or * 0*.

. Click * Save*.


* CLI Command* 


To set Activity log Retention (days) to * 365 or greater*, use the following command:
----
az monitor log-profiles update
--name & lt;logProfileName>
--set retentionPolicy.days=& lt;number of days> retentionPolicy.enabled=true
----
To store logs for fo


* Terrarever (indefinitely), use the following command:* 


----
az monitor log-profiles update
--name & lt;logProfileName>
--set retentionPolicy.days=0 retentionPolicy.enabled=false
----
////
=== Fix - Buildtime


*Terraform* 


* *Resource:* azurerm_monitor_log_profile
* *Arguments:* retention policy


*Option 1* 




[source,go]
----
resource "azurerm_monitor_log_profile" "example" {
    name = "default"
    categories = [
    "Action",
    "Delete",
    "Write",
    ]
    locations = [
    "westus",
    "global",
    ]
+    retention_policy {
+    enabled = true
+    days    = 365
    }
}
----


*Option 2* 




[source,go]
----
resource "azurerm_monitor_log_profile" "example" {
    name = "default"
    categories = [
    "Action",
    "Delete",
    "Write",
    ]
    locations = [
    "westus",
    "global",
    ]
+    retention_policy {
+    enabled = false
+    days    = 0
    }
}
----
