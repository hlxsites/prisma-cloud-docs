== AKS Cluster Without Upgrade Channel
// Ensure AKS cluster upgrade channel is chosen

=== Rule Details

[cols="1,2"]
|===
|Cortex AppSec Rule ID |APPSEC_AZURE_171
|Category |PUBLIC_EXPOSURE - VPC_VCN_VNET
|Provider |Azure
|Severity |LOW
|Framework |Terraform, Terraform Plan, ARM, Bicep
|Mapped CSPM/KSPM Rule |None
|===


=== Fix - Buildtime

*Terraform*

* *Resource:* azurerm_kubernetes_cluster
* *Arguments:* automatic_upgrade_channel

[source,terraform]
----
resource "azurerm_kubernetes_cluster" "example" {
  name                = "example-aks1"
  location            = azurerm_resource_group.example.location
  resource_group_name = azurerm_resource_group.example.name

  # If using azurerm version below 4.0
+ automatic_channel_upgrade = "stable"
  # If using azurerm version 4.0 and above
+ automatic_upgrade_channel = "stable"

  default_node_pool {
    name       = "default"
    node_count = 1
    vm_size    = "Standard_D2_v2"
  }

  identity {
    type = "SystemAssigned"
  }

  tags = {
    Environment = "production"
  }
}
----
