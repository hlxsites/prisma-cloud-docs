== AWS Image Builder component not encrypted using Customer Managed Key misconfiguration detected in code


=== Rule Details

[cols="1,2"]
|===
|Cortex AppSec Rule ID |APPSEC_AWS_180
|Category |Storage - Encryption
|Provider |AWS
|Severity |LOW
|Framework |Terraform, Terraform Plan
|Mapped CSPM/KSPM Rule |None
|===


=== Impact
This is a simple check to ensure that Image builder component is using AWS key management - KMS to encrypt its contents.
To resolve add the ARN of your KMS or link on creation of the component.

=== How to Fix


*Terraform* 


* *Resource:* aws_imagebuilder_component
* *Attribute:* kms_key_id - (Optional) Amazon Resource Name (ARN) of the Key Management Service (KMS) Key used to encrypt the component.


[source,go]
----
resource "aws_imagebuilder_component" "example" {
  data = yamlencode({
    phases = [{
      name = "build"
      steps = [{
        action = "ExecuteBash"
        inputs = {
          commands = ["echo 'hello world'"]
        }
        name      = "example"
        onFailure = "Continue"
      }]
    }]
    schemaVersion = 1.0
  })
  name     = "example"
  platform = "Linux"
  version  = "1.0.0"
  kms_key_id = "ckv_kms"
}
----
