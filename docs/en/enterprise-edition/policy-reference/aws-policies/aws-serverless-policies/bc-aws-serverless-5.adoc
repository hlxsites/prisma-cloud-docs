== AWS Lambda environment variable encryption settings are not using a CMK


=== Policy Details
[width=45%]
[cols="1,1"]
|=== 
|Prisma Cloud Policy ID 
| b3c159b3-00cb-42f3-8841-14e434421947

|Checkov ID 
| https://github.com/bridgecrewio/checkov/tree/master/checkov/terraform/checks/resource/aws/LambdaEnvironmentEncryptionSettings.py[CKV_AWS_173]

|Severity
|LOW

|Subtype
|Build

|Frameworks
|CloudFormation,Terraform,TerraformPlan,Serverless

|=== 



=== Description

Lambda always provides server-side encryption at rest with an AWS KMS key. By default, Lambda uses an AWS managed key. To enable rotation and revocation on your own schedule, you should use a https://docs.aws.amazon.com/kms/latest/developerguide/concepts.html#customer-cmk[Customer Managed Key].

=== Fix - Buildtime

*Terraform* 

* *Resource:* aws_lambda_function
* *Arguments:* kms_key_arn


[source,go]
----
{
 "resource "aws_lambda_function" "test_lambda" {
  filename      = "lambda_function_payload.zip"
  function_name = "lambda_function_name"
  role          = aws_iam_role.iam_for_lambda.arn
  handler       = "index.test"

  runtime = "nodejs12.x"
  
+ kms_key_arn = "ckv_km"
  
  environment {
    variables = {
      foo = "bar"
    }
  }
}
----
